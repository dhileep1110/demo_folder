<table class="table table-bordered">
    <tr>
        <th>Merchant ID</th>
        <th>Email</th>
        <th>Status</th>
        <th>Expiry Date</th>
        <th>Action</th>
    </tr>

    <c:forEach var="row" items="${consentList}">
        <tr>
            <td>${row.merchantId}</td>
            <td>${row.email}</td>

            <td>
                <c:choose>
                    <c:when test="${row.status == 'PENDING'}">
                        <span style="color:orange;">Pending</span>
                    </c:when>
                    <c:when test="${row.status == 'APPROVED'}">
                        <span style="color:green;">Approved</span>
                    </c:when>
                    <c:otherwise>
                        <span style="color:red;">Rejected / Expired</span>
                    </c:otherwise>
                </c:choose>
            </td>

            <td>
                <c:if test="${row.status == 'PENDING'}">
                    ${row.expiryDate}
                </c:if>
                <c:if test="${row.status != 'PENDING'}">
                    -
                </c:if>
            </td>

            <td>
                <c:if test="${row.status == 'EXPIRED'}">
                    <form action="resendConsent.action" method="post">
                        <input type="hidden" name="consentId"
                               value="${row.consentId}" />
                        <input type="submit" value="Resend"
                               class="btn btn-sm btn-primary"/>
                    </form>
                </c:if>
                <c:if test="${row.status != 'EXPIRED'}">
                    -
                </c:if>
            </td>

        </tr>
    </c:forEach>
</table>


public String resendConsent() {

    String newToken = generateToken();

    consentDAO.resendConsent(consentId, expiryDays, newToken);

    consentMailService.sendConsentMail(newToken);

    return SUCCESS;


}

public void sendConsentMail(String mercEmail, String mercCode,String mercName, String token, SessionBean sessionBean) {
		try
		{	
			String baseurl = ServletActionContext.getRequest().getRequestURL().substring(0,
					(ServletActionContext.getRequest().getRequestURL()).lastIndexOf("/"));
			EmailBean emailBean = new EmailBean();
			emailBean.setPriority("1");
			emailBean.setTo(mercEmail);
			emailBean.setSubject("Consent Required – Merchant Onboarding Request");
			emailBean.setVelocityTemplateName("consentAggrementEmail.html");
			
			Map<String, Object> bodyMap = new HashMap<String, Object>();
			bodyMap.put("mer_name", mercName);	
			bodyMap.put("instName", sessionBean.getInstName());
			bodyMap.put("Consent_Link", baseurl + "/" + "consentProcess.action?" +token+"&mercCode="+mercCode);
			emailBean.setBodyVariables(bodyMap);
			emailService.sendEmail(emailBean);
		}catch (Exception e) {
			loggerUtil.error("Error while sending merchant Confirmation mail to maker", e);
		}
	}
<%@ page contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="s" uri="/struts-tags"%>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Merchant Consent</title>

<style>
body {
    font-family: Arial, Helvetica, sans-serif;
    background-color: #f4f6f9;
    margin: 0;
}

.main-container {
    width: 100%;
    display: flex;
    justify-content: center;
    margin-top: 40px;
}

.consent-card {
    width: 700px;
    background: #ffffff;
    padding: 30px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.header {
    text-align: center;
    font-size: 20px;
    font-weight: bold;
    margin-bottom: 20px;
    color: #d71810;
}

.question-box {
    font-weight: bold;
    margin-bottom: 15px;
    text-align: center;
}

.agreement-box {
    border: 1px solid #ccc;
    height: 220px;
    overflow-y: auto;
    padding: 15px;
    font-size: 14px;
    line-height: 1.6;
    background: #fafafa;
    text-align: left;   /* LEFT ALIGNMENT */
}

.checkbox-section {
    margin-top: 15px;
}

.button-section {
    margin-top: 25px;
    text-align: center;
}

.btn {
    padding: 10px 25px;
    font-size: 14px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin: 0 10px;
}

.btn-yes {
    background: #28a745;
    color: #fff;
}

.btn-no {
    background: #dc3545;
    color: #fff;
}

.btn:disabled {
    background: #b5b5b5;
    cursor: not-allowed;
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function () {

    let isScrolled = false;

    const agreementBox = document.getElementById("agreementBox");
    const agreeChk = document.getElementById("agreeChk");
    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");

    agreementBox.addEventListener("scroll", function () {
        if (agreementBox.scrollTop + agreementBox.clientHeight >= agreementBox.scrollHeight) {
            isScrolled = true;
            agreeChk.disabled = false;
        }
    });

    agreeChk.addEventListener("change", function () {
        yesBtn.disabled = !this.checked;
        noBtn.disabled = !this.checked;
    });

    window.submitConsent = function (decision) {

        if (!isScrolled) {
            alert("Please read the agreement fully before proceeding.");
            return;
        }

        if (!agreeChk.checked) {
            alert("Please confirm that you agree to the terms.");
            return;
        }

        document.getElementById("decision").value = decision;
        document.forms[0].submit();
    };

});
</script>

</head>

<body>

<div class="main-container">
    <div class="consent-card">

        <div class="header">
            Merchant Onboarding Consent
        </div>

        <div class="question-box">
            Would you like to register for our Bank Acquiring Services?
        </div>

        <s:form action="consentApproval" method="post">

            <div id="agreementBox" class="agreement-box">

                <b>Merchant Agreement</b><br><br>

                This agreement is made between the Merchant and the Bank for availing acquiring services.
                By accepting this agreement, the Merchant agrees to comply with all rules, regulations,
                and operational guidelines prescribed by the Bank.<br><br>

                The Merchant confirms that all information provided is true and valid.
                The Bank reserves the right to verify, approve, or reject the request
                based on internal policies.<br><br>

                The services include transaction processing, settlement, reporting,
                and related merchant acquiring facilities.<br><br>

                The Merchant understands that clicking “Yes” shall be considered as
                a digital acceptance of this agreement.<br><br>

                Any misuse, fraudulent activity, or violation may lead to termination
                of services without prior notice.<br><br>

                (Scroll till end to enable acceptance...)

            </div>

            <div class="checkbox-section">
                <input type="checkbox" id="agreeChk" disabled />
                I have read and understood the agreement fully
            </div>

            <div class="button-section">
                <button type="button" class="btn btn-yes"
                        onclick="submitConsent('APPROVED')" disabled id="yesBtn">Yes</button>

                <button type="button" class="btn btn-no"
                        onclick="submitConsent('REJECTED')" disabled id="noBtn">No</button>
            </div>

            <!-- Hidden fields -->
            <s:hidden name="token"/>
            <s:hidden name="mercCode"/>
            <s:hidden name="decision" id="decision"/>

        </s:form>

    </div>
</div>

</body>
</html>
